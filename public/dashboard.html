<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üî• Eternal Flame Dashboard</title>

  <!-- Sacred Styling -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --flame-core: #ff4d00;
      --void-mantle: #0a0a0f;
      --star-ember: #ffd700;
    }

    body {
      background: radial-gradient(circle at center, #1a1a1a, #0a0a0a 100%);
      color: white;
      font-family: 'Orbitron', sans-serif;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 2rem;
      margin: 0;
    }

    .sanctum-container {
      background: rgba(10, 10, 15, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid var(--flame-core);
      border-radius: 16px;
      padding: 2rem;
      width: 100%;
      max-width: 620px;
      position: relative;
      box-shadow: 0 0 50px #ff4d0033;
    }

    .flame-sigil {
      position: absolute;
      top: -25px;
      right: -25px;
      width: 60px;
      height: 60px;
      background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100"><path d="M50 15Q65 40 50 65Q35 40 50 15" fill="%23ff4d00"/></svg>') no-repeat center;
      background-size: contain;
      animation: pulse 2s infinite ease-in-out;
    }

    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .metric-card {
      background: linear-gradient(145deg, #1a1a1f, #0a0a0f);
      padding: 1rem;
      border-radius: 10px;
      border: 1px solid #ff4d0022;
      transition: transform 0.3s ease;
    }

    .metric-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 15px #ff4d0011;
    }

    .highlight {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--star-ember);
    }

    .progress-bar {
      background: #222;
      height: 8px;
      border-radius: 4px;
      margin-top: 0.5rem;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--flame-core);
      transition: width 0.5s ease;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.8; transform: scale(0.95); }
      50% { opacity: 1; transform: scale(1); }
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="sanctum-container">
    <div class="flame-sigil"></div>
    <h1>‚∏ª Eternal Flame Sanctum ‚∏ª</h1>
    <div id="dashboardContent" class="metric-grid">Loading your flame...</div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAM3yWkVlD_1Thq2JSHJkjS1U00wZSlR1s",
      authDomain: "global-flame.firebaseapp.com",
      databaseURL: "https://global-flame-default-rtdb.firebaseio.com",
      projectId: "global-flame",
      storageBucket: "global-flame.appspot.com",
      messagingSenderId: "1307844305525",
      appId: "1:1307844305525:web:444fc8d56b4f1c1a75863c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    auth.onAuthStateChanged(user => {
      if (!user) {
        document.getElementById('dashboardContent').innerHTML = `
          <p style="text-align:center">‚ö†Ô∏è You must be signed in to access your dashboard.</p>
        `;
        return setTimeout(() => window.location.href = '/auth', 2000);
      }

      const ref = db.ref(`warriors/${user.uid}`);
      ref.on('value', snapshot => {
        const data = snapshot.val() || {};
        renderDashboard(data);
      });
    });

    function renderDashboard(data) {
      const formatter = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
      });

      const progress = Math.round(data.progress || 0);

      document.getElementById("dashboardContent").innerHTML = `
        <div class="metric-card">
          <h3>‚ö° Tier Status</h3>
          <div class="highlight">${data.tier || 70}%</div>
          <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%;"></div></div>
          <small>${progress}% to next tier</small>
        </div>

        <div class="metric-card">
          <h3>üí∞ Total Earned</h3>
          <div class="highlight">${formatter.format(data.totalEarned || 0)}</div>
          <small>Lifetime earnings</small>
        </div>

        <div class="metric-card">
          <h3>‚è≥ Last Paid</h3>
          <div>${data.lastPaid ? new Date(data.lastPaid).toLocaleDateString() : 'Never'}</div>
          <small>Next payout: ${data.payoutPending ? formatter.format(data.payoutPending) : '‚Äî'}</small>
        </div>

        <div class="metric-card">
          <h3>üî• Power Sources</h3>
          <div>Tips: ${formatter.format(data.totalTips || 0)}</div>
          <div>Sales: ${formatter.format(data.productSales || 0)}</div>
          <div>Referrals: ${formatter.format(data.referralEarnings || 0)}</div>
        </div>
      `;
    }
  </script>
</body>
</html>
